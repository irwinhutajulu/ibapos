<!DOCTYPE html>
<html lang="en" class="h-full" x-data="{ sidebarOpen: false, darkMode: localStorage.getItem('darkMode') === 'true' }" x-init="if(darkMode) $el.classList.add('dark'); else $el.classList.remove('dark')" x-cloak>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>IBAPOS</title>
    <meta name="csrf-token" content="VIlWl2BA4AMZKyCW3NKG7NhiEdCTp9YnQD51E8hQ">
    <link rel="preload" as="style" href="http://localhost/Data%20IBA%20POS/IBAPOS/public/build/assets/app-DJg37ntv.css" /><link rel="modulepreload" as="script" href="http://localhost/Data%20IBA%20POS/IBAPOS/public/build/assets/app-C2ctN-da.js" /><link rel="stylesheet" href="http://localhost/Data%20IBA%20POS/IBAPOS/public/build/assets/app-DJg37ntv.css" /><script type="module" src="http://localhost/Data%20IBA%20POS/IBAPOS/public/build/assets/app-C2ctN-da.js"></script>    <style>
        [x-cloak] { display: none !important; }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(156, 163, 175, 0.4); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(156, 163, 175, 0.6); }
        
        /* Smooth transitions */
        * { transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease; }
        
        /* Glass effect */
        .glass { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.8); }
        .glass-dark { backdrop-filter: blur(10px); background: rgba(31, 41, 55, 0.8); }
    </style>
    <script>
        // Safe stub: queue notifications fired before Alpine toast component is ready
        window._notifyQueue = window._notifyQueue || [];
        window.notify = window.notify || function (msg, type = 'info', ttl = 3500) {
            window._notifyQueue.push({ msg, type, ttl });
        };
    </script>
</head>
<body class="h-full bg-gradient-to-br from-slate-50 to-slate-100 dark:from-gray-900 dark:to-gray-800 text-gray-900 dark:text-gray-100 antialiased">
    <div class="min-h-screen flex">
        <!-- Mobile backdrop -->
        <div x-show="sidebarOpen" 
             x-transition:enter="transition-opacity ease-linear duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition-opacity ease-linear duration-300"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             @click="sidebarOpen = false"
             class="fixed inset-0 z-30 bg-black bg-opacity-50 lg:hidden"></div>

        <!-- Sidebar -->
        <div :class="sidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'"
             class="fixed inset-y-0 z-40 w-72 transform bg-white/90 dark:bg-gray-800/90 backdrop-blur-xl border-r border-gray-200/50 dark:border-gray-700/50 transition-transform duration-300 ease-in-out lg:static lg:inset-auto">
            
            <!-- Logo & Brand -->
            <div class="h-20 flex items-center px-6 border-b border-gray-200/50 dark:border-gray-700/50">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center">
                        <span class="text-white font-bold text-lg">IB</span>
                    </div>
                    <div>
                        <div class="flex items-center space-x-2">
                            <h1 class="font-bold text-xl text-gray-900 dark:text-white">IBAPOS</h1>
                                                            <span class="bg-orange-500 text-white text-xs px-2 py-1 rounded-full font-semibold">DEV</span>
                                                    </div>
                        <p class="text-xs text-gray-500 dark:text-gray-400">
                            Point of Sale
                                                            <span class="text-orange-500"> â€¢ Developer Mode</span>
                                                    </p>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="p-6 space-y-2 overflow-y-auto h-full">
                <!-- Dashboard -->
                <a href="/" class="group flex items-center space-x-3 px-4 py-3 rounded-xl hover:bg-gray-100/80 dark:hover:bg-gray-700/50 transition-all duration-200 font-medium text-gray-700 dark:text-gray-200">
                    <div class="w-5 h-5 text-gray-500 group-hover:text-blue-500 transition-colors">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v0H8v0z"></path>
                        </svg>
                    </div>
                    <span>Dashboard</span>
                </a>

                <!-- Sales Section -->
                <div class="pt-4">
                    <p class="text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider px-4 pb-2">Sales</p>
                                        <a href="http://localhost/Data%20IBA%20POS/IBAPOS/public/pos" class="group flex items-center space-x-3 px-4 py-3 rounded-xl hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200 text-gray-700 dark:text-gray-200">
                        <div class="w-5 h-5 text-blue-500">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                        <span>Point of Sale</span>
                    </a>
                                                            <a href="http://localhost/Data%20IBA%20POS/IBAPOS/public/sales" class="group flex items-center space-x-3 px-4 py-3 rounded-xl hover:bg-gray-100/80 dark:hover:bg-gray-700/50 transition-all duration-200 text-gray-700 dark:text-gray-200">
                        <div class="w-5 h-5 text-gray-500 group-hover:text-blue-500 transition-colors">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m6-5v6a2 2 0 01-2 2H9a2 2 0 01-2-2v-6m8 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v4"></path>
                            </svg>
                        </div>
                        <span>Sales History</span>
                    </a>
                                    </div>

                <!-- Inventory Section -->
                <div class="pt-4">
                    <p class="text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider px-4 pb-2">Inventory</p>
                                        <a href="http://localhost/Data%20IBA%20POS/IBAPOS/public/products" class="group flex items-center space-x-3 px-4 py-3 rounded-xl hover:bg-gray-100/80 dark:hover:bg-gray-700/50 transition-all duration-200 text-gray-700 dark:text-gray-200">
                        <div class="w-5 h-5 text-gray-500 group-hover:text-green-500 transition-colors">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M9 9l3-3 3 3"></path>
                            </svg>
                        </div>
                        <span>Products</span>
                    </a>
                                                            <a href="http://localhost/Data%20IBA%20POS/IBAPOS/public/categories" class="group flex items-center space-x-3 px-4 py-3 rounded-xl hover:bg-gray-100/80 dark:hover:bg-gray-700/50 transition-all duration-200 text-gray-700 dark:text-gray-200">
                        <div class="w-5 h-5 text-gray-500 group-hover:text-green-500 transition-colors">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                            </svg>
                        </div>
                        <span>Categories</span>
                    </a>
                                                            <a href="http://localhost/Data%20IBA%20POS/IBAPOS/public/stocks" class="group flex items-center space-x-3 px-4 py-3 rounded-xl hover:bg-gray-100/80 dark:hover:bg-gray-700/50 transition-all duration-200 text-gray-700 dark:text-gray-200">
                        <div class="w-5 h-5 text-gray-500 group-hover:text-green-500 transition-colors">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                        <span>Stock Levels</span>
                    </a>
                    <a href="http://localhost/Data%20IBA%20POS/IBAPOS/public/stock-adjustments" class="group flex items-center space-x-3 px-4 py-3 rounded-xl hover:bg-gray-100/80 dark:hover:bg-gray-700/50 transition-all duration-200 text-gray-700 dark:text-gray-200">
                        <div class="w-5 h-5 text-gray-500 group-hover:text-green-500 transition-colors">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                            </svg>
                        </div>
                        <span>Adjustments</span>
                    </a>
                                                            <a href="http://localhost/Data%20IBA%20POS/IBAPOS/public/stock-mutations" class="group flex items-center space-x-3 px-4 py-3 rounded-xl hover:bg-gray-100/80 dark:hover:bg-gray-700/50 transition-all duration-200 text-gray-700 dark:text-gray-200">
                        <div class="w-5 h-5 text-gray-500 group-hover:text-green-500 transition-colors">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                            </svg>
                        </div>
                        <span>Stock Transfers</span>
                    </a>
                                    </div>

                <!-- Procurement Section -->
                <div class="pt-4">
                    <p class="text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider px-4 pb-2">Procurement</p>
                                        <a href="http://localhost/Data%20IBA%20POS/IBAPOS/public/purchases" class="group flex items-center space-x-3 px-4 py-3 rounded-xl hover:bg-gray-100/80 dark:hover:bg-gray-700/50 transition-all duration-200 text-gray-700 dark:text-gray-200">
                        <div class="w-5 h-5 text-gray-500 group-hover:text-purple-500 transition-colors">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
                            </svg>
                        </div>
                        <span>Purchases</span>
                    </a>
                                                            <a href="http://localhost/Data%20IBA%20POS/IBAPOS/public/suppliers" class="group flex items-center space-x-3 px-4 py-3 rounded-xl hover:bg-gray-100/80 dark:hover:bg-gray-700/50 transition-all duration-200 text-gray-700 dark:text-gray-200">
                        <div class="w-5 h-5 text-gray-500 group-hover:text-purple-500 transition-colors">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                            </svg>
                        </div>
                        <span>Suppliers</span>
                    </a>
                                    </div>

                <!-- Customers Section -->
                <div class="pt-4">
                    <p class="text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider px-4 pb-2">Customers</p>
                                        <a href="http://localhost/Data%20IBA%20POS/IBAPOS/public/customers" class="group flex items-center space-x-3 px-4 py-3 rounded-xl hover:bg-gray-100/80 dark:hover:bg-gray-700/50 transition-all duration-200 text-gray-700 dark:text-gray-200">
                        <div class="w-5 h-5 text-gray-500 group-hover:text-indigo-500 transition-colors">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5 0a4 4 0 11-8 0 4 4 0 018 0z"></path>
                            </svg>
                        </div>
                        <span>Customers</span>
                    </a>
                                    </div>

                <!-- System Section -->
                <div class="pt-6 border-t border-gray-200/50 dark:border-gray-700/50">
                    <p class="text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider px-4 pb-2">System</p>
                                        <a href="http://localhost/Data%20IBA%20POS/IBAPOS/public/reservations" class="group flex items-center space-x-3 px-4 py-3 rounded-xl hover:bg-gray-100/80 dark:hover:bg-gray-700/50 transition-all duration-200 text-gray-700 dark:text-gray-200">
                        <div class="w-5 h-5 text-gray-500 group-hover:text-yellow-500 transition-colors">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                            </svg>
                        </div>
                        <span>Reservations</span>
                    </a>
                                        <a href="#" class="group flex items-center space-x-3 px-4 py-3 rounded-xl hover:bg-gray-100/80 dark:hover:bg-gray-700/50 transition-all duration-200 text-gray-700 dark:text-gray-200">
                        <div class="w-5 h-5 text-gray-500 group-hover:text-emerald-500 transition-colors">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                        <span>Reports</span>
                    </a>
                                        <a href="http://localhost/Data%20IBA%20POS/IBAPOS/public/admin/notifications" class="group flex items-center space-x-3 px-4 py-3 rounded-xl hover:bg-gray-100/80 dark:hover:bg-gray-700/50 transition-all duration-200 text-gray-700 dark:text-gray-200">
                        <div class="w-5 h-5 text-gray-500 group-hover:text-red-500 transition-colors">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM9.586 14.414L7.5 16.5 2 11l2.586-2.586L9.586 14.414z"></path>
                            </svg>
                        </div>
                        <span>Notifications</span>
                    </a>
                                                            <a href="http://localhost/Data%20IBA%20POS/IBAPOS/public/locations" class="group flex items-center space-x-3 px-4 py-3 rounded-xl hover:bg-gray-100/80 dark:hover:bg-gray-700/50 transition-all duration-200 text-gray-700 dark:text-gray-200">
                        <div class="w-5 h-5 text-gray-500 group-hover:text-blue-500 transition-colors">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                        </div>
                        <span>Locations</span>
                    </a>
                                                            <a href="http://localhost/Data%20IBA%20POS/IBAPOS/public/admin/users" class="group flex items-center space-x-3 px-4 py-3 rounded-xl hover:bg-gray-100/80 dark:hover:bg-gray-700/50 transition-all duration-200 text-gray-700 dark:text-gray-200">
                        <div class="w-5 h-5 text-gray-500 group-hover:text-gray-600 transition-colors">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                        </div>
                        <span>Users</span>
                    </a>
                                    </div>

                <!-- Dark Mode Toggle -->
                <div class="pt-6 border-t border-gray-200/50 dark:border-gray-700/50">
                    <button @click="darkMode = !darkMode; localStorage.setItem('darkMode', darkMode); if(darkMode) $root.classList.add('dark'); else $root.classList.remove('dark')" 
                            class="w-full flex items-center space-x-3 px-4 py-3 rounded-xl hover:bg-gray-100/80 dark:hover:bg-gray-700/50 transition-all duration-200 text-gray-700 dark:text-gray-200">
                        <div class="w-5 h-5 text-gray-500">
                            <svg x-show="!darkMode" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                            </svg>
                            <svg x-show="darkMode" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                            </svg>
                        </div>
                        <span x-text="darkMode ? 'Light Mode' : 'Dark Mode'"></span>
                    </button>
                </div>
            </nav>
        </div>
        <!-- Main Content -->
        <div class="flex-1 flex flex-col min-w-0">
            <!-- Header -->
            <header class="h-20 flex items-center justify-between bg-white/80 dark:bg-gray-800/80 backdrop-blur-xl border-b border-gray-200/50 dark:border-gray-700/50 px-6 sticky top-0 z-20">
                <div class="flex items-center space-x-4">
                    <!-- Mobile Menu Button -->
                    <button class="lg:hidden p-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                            @click="sidebarOpen = !sidebarOpen" aria-label="Toggle sidebar">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>

                    
                </div>

                <div class="flex items-center space-x-4">
                    <!-- Search Bar (Hidden on mobile) -->
                    <div class="hidden md:flex items-center">
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                            <input type="text" placeholder="Search..." 
                                   class="block w-64 pl-10 pr-3 py-2 border border-gray-200 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" />
                        </div>
                    </div>

                    <!-- Location Selector Component -->
                    <div class="flex items-center space-x-2" x-data="locationSelector()">
    <label class="text-sm font-medium text-gray-600 dark:text-gray-400">Location:</label>
    <select x-model="selected" @change="set()"
            :disabled="loading"
            class="px-3 py-2 border border-gray-200 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                            <option value="12" selected>Istana Batu Alam Manado</option>
                    <option value="15" >Istana Batu Alam Minut</option>
            </select>
    <!-- loading spinner -->
    <div x-show="loading" class="w-6 h-6 flex items-center justify-center">
        <svg class="animate-spin h-4 w-4 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
        </svg>
    </div>
</div>

<script>
    function locationSelector() {
        return {
            loading: false,
            selected: 12,
            async set() {
                const prev = this.selected;
                // optimistic UI: save selection locally and set global var
                try {
                    // write immediately to localStorage for instant persistence
                    localStorage.setItem('active_location_id', String(this.selected));
                    window.appActiveLocationId = this.selected;
                } catch (e) {
                    console.warn('localStorage not available', e);
                }

                this.loading = true;

                try {
                    const token = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
                    const res = await fetch('http://localhost/Data%20IBA%20POS/IBAPOS/public/active-location', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRF-TOKEN': token,
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({ location_id: this.selected })
                    });

                    if (!res.ok) {
                        const err = await res.text();
                        window.notify('Failed to change active location', 'error');
                        console.error('Active location error', err);
                        // revert optimistic change
                        this.revert(prev);
                        return;
                    }

                    const data = await res.json();
                    if (data.success) {
                        window.appActiveLocationId = data.active_location_id;
                        try { localStorage.setItem('active_location_id', String(data.active_location_id)); } catch (e) {}
                        window.notify('Active location set', 'success');
                    } else {
                        window.notify('Failed to set location', 'error');
                        this.revert(prev);
                    }
                } catch (e) {
                    console.error(e);
                    window.notify('Network error while setting location', 'error');
                    this.revert(prev);
                } finally {
                    this.loading = false;
                }
            },
            revert(prev) {
                // revert UI and localStorage
                this.selected = prev;
                try { localStorage.setItem('active_location_id', String(prev)); } catch (e) {}
                window.appActiveLocationId = prev;
            }
        }
    }
</script>

                    <!-- Developer Mode Indicator -->
                                        <div class="flex items-center space-x-2 px-3 py-2 bg-orange-100 dark:bg-orange-900/20 text-orange-800 dark:text-orange-300 rounded-xl border border-orange-200 dark:border-orange-800">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                        </svg>
                        <span class="text-sm font-medium">Developer Mode</span>
                    </div>
                    
                    <!-- Notifications Button -->
                    <button class="relative p-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                        <svg class="w-6 h-6 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM9.586 14.414L7.5 16.5 2 11l2.586-2.586L9.586 14.414z"></path>
                        </svg>
                        <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
                    </button>

                    <!-- User Menu -->
                                        <div class="relative inline-block text-left " x-data="{ open: false }">
    <!-- Trigger -->
    <div @click="open = !open">
                    <button type="button" class="flex items-center space-x-2 p-2 rounded-lg text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
            <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full flex items-center justify-center">
                <span class="text-white text-sm font-medium">A</span>
            </div>
            <svg class="w-4 h-4 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
        </button>
            </div>

    <!-- Dropdown Menu -->
    <div x-show="open" 
         @click.away="open = false"
         @keydown.escape.window="open = false"
         x-transition:enter="transition ease-out duration-100"
         x-transition:enter-start="transform opacity-0 scale-95"
         x-transition:enter-end="transform opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-75"
         x-transition:leave-start="transform opacity-100 scale-100"
         x-transition:leave-end="transform opacity-0 scale-95"
         class="absolute origin-top-right right-0 mt-2 w-56 rounded-xl shadow-lg bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 border border-gray-200 dark:border-gray-600 z-50 py-2"
         style="display: none;">
         
                <!-- Header -->
        <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50 rounded-t-xl">
            <div class="flex items-center space-x-3">
            <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full flex items-center justify-center">
                <span class="text-white font-medium">A</span>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-900 dark:text-white">Administrator</p>
                <p class="text-xs text-gray-500 dark:text-gray-400">admin@example.com</p>
            </div>
        </div>
        </div>
        
                <!-- Custom Content Slot -->
        <div class="py-1">
            <!-- Profile Link -->
    
    <!-- Settings Link -->
    
    <!-- Divider -->
    <div class="border-t border-gray-200 dark:border-gray-600 my-1"></div>

    <!-- Logout -->
    <form method="POST" action="http://localhost/Data%20IBA%20POS/IBAPOS/public/logout">
        <input type="hidden" name="_token" value="VIlWl2BA4AMZKyCW3NKG7NhiEdCTp9YnQD51E8hQ" autocomplete="off">        <button type="submit" class="group flex items-center w-full px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors text-left">
            <svg class="mr-3 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
            </svg>
            Sign Out
        </button>
    </form>
        </div>
        
            </div>
</div>
                                    </div>
            </header>

            <!-- Main Content -->
            <main class="flex-1 p-6 lg:p-8 overflow-auto">
                                
                
                <div class="p-6">
    <div class="mb-6 flex justify-between items-center">
        <div>
            <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Users</h1>
            <p class="text-gray-600 dark:text-gray-400">Manage application users and their roles/permissions</p>
        </div>
        <a href="http://localhost/Data%20IBA%20POS/IBAPOS/public/admin/users/create" 
           class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors duration-200 flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            New User
        </a>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                <thead class="bg-gray-50 dark:bg-gray-700">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Name</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Email</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Roles</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700" data-user-id="8">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900 dark:text-white">Administrator</div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="text-sm text-gray-900 dark:text-gray-300">admin@example.com</div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="flex flex-wrap gap-1">
                                                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100">super-admin</span>
                                                                    </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <div class="flex justify-end space-x-2">
                                    <a href="http://localhost/Data%20IBA%20POS/IBAPOS/public/admin/users/8/edit" class="text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                                    </a>
                                    <button type="button" data-delete-modal="userDeleteModal" data-delete-id="8" data-delete-name="Administrator" data-delete-action="/admin/users" class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300" title="Delete User">
                                        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                    </button>
                                </div>
                            </td>
                        </tr>
                                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700" data-user-id="9">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900 dark:text-white">Irwin Hutajulu</div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="text-sm text-gray-900 dark:text-gray-300">irwinhutajulu@gmail.com</div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="flex flex-wrap gap-1">
                                                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100">admin</span>
                                                                    </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <div class="flex justify-end space-x-2">
                                    <a href="http://localhost/Data%20IBA%20POS/IBAPOS/public/admin/users/9/edit" class="text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                                    </a>
                                    <button type="button" data-delete-modal="userDeleteModal" data-delete-id="9" data-delete-name="Irwin Hutajulu" data-delete-action="/admin/users" class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300" title="Delete User">
                                        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                    </button>
                                </div>
                            </td>
                        </tr>
                                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700" data-user-id="10">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900 dark:text-white">Adi</div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="text-sm text-gray-900 dark:text-gray-300">adi@nirmala.love</div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="flex flex-wrap gap-1">
                                                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100">cashier</span>
                                                                    </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <div class="flex justify-end space-x-2">
                                    <a href="http://localhost/Data%20IBA%20POS/IBAPOS/public/admin/users/10/edit" class="text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                                    </a>
                                    <button type="button" data-delete-modal="userDeleteModal" data-delete-id="10" data-delete-name="Adi" data-delete-action="/admin/users" class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300" title="Delete User">
                                        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                    </button>
                                </div>
                            </td>
                        </tr>
                                    </tbody>
            </table>
        </div>
    </div>

    </div>

<div id="userDeleteModal" style="display:none;" class="fixed inset-0 bg-black bg-opacity-40 overflow-y-auto h-full w-full hidden z-50 flex items-center justify-center" aria-hidden="true">
    <div class="relative mx-auto p-6 border w-96 max-w-sm shadow-2xl rounded-xl bg-white dark:bg-gray-800" role="dialog" aria-modal="true" aria-labelledby="userDeleteModal_title" aria-describedby="userDeleteModal_desc">
        <div class="text-center">
            <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100 dark:bg-red-900 mb-4">
                <svg class="h-8 w-8 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                </svg>
            </div>
            <h3 id="userDeleteModal_title" class="text-xl font-semibold text-gray-900 dark:text-white mb-3">Delete user</h3>
            <div id="userDeleteModal_desc" class="mb-6">
                <p class="text-gray-600 dark:text-gray-400 text-sm leading-relaxed">
                    Are you sure you want to delete <span class='confirm-target-name font-semibold text-gray-900 dark:text-white'></span>?
                </p>
                <p class="text-red-500 dark:text-red-400 text-xs mt-2 font-medium">
                    This action cannot be undone.
                </p>
            </div>
            <div class="flex justify-center space-x-3">
                <button type="button" data-close-button="userDeleteModal"
                        class="px-6 py-2.5 bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 text-sm font-medium rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-300 transition-all duration-200 min-w-[80px]">
                    Cancel
                </button>

                <form id="userDeleteModal_form" method="POST" class="inline" data-ajax="true">
                    <input type="hidden" name="_token" value="VIlWl2BA4AMZKyCW3NKG7NhiEdCTp9YnQD51E8hQ" autocomplete="off">                    <input type="hidden" name="_method" value="DELETE">                    <button type="submit" id="userDeleteModal_confirm" class="px-6 py-2.5 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center justify-center gap-2 min-w-[80px]">
                        <span class="confirm-text">Delete</span>
                        <svg class="confirm-loading w-4 h-4 animate-spin hidden" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
/* Confirmation modal helper (available globally) */
window.openConfirmationModal = window.openConfirmationModal || function(modalId, actionUrl, name, options = {}) {
    const modal = document.getElementById(modalId);
    const form = document.getElementById(modalId + '_form');
    const confirmBtn = document.getElementById(modalId + '_confirm');

    if (!modal || !form || !confirmBtn) {
        console.error('Confirmation modal elements not found:', modalId);
        return false;
    }

    // Fill name placeholders inside modal (if any)
    const nameSpans = modal.querySelectorAll('.confirm-target-name');
    nameSpans.forEach(s => s.textContent = name);

    // set form action so fallback non-JS works
    form.action = actionUrl;

    // Store data attributes for use in submit handler
    form.dataset.ajax = options.ajax === false ? 'false' : 'true';
    form.dataset.rowId = options.rowId || '';

    // Save the previously focused element so we can restore focus later
    modal.__previouslyFocused = document.activeElement;

    // Show modal and set aria
    modal.style.display = '';
    modal.classList.remove('hidden');
    modal.setAttribute('aria-hidden', 'false');
    // Lock background scroll
    document.body.style.overflow = 'hidden';

    // Focus first focusable element inside modal (confirm button or other)
    const focusable = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
    const firstFocusable = focusable.length ? focusable[0] : confirmBtn;
    (firstFocusable || confirmBtn).focus();

    // Setup simple focus trap
    function trapTabKey(e) {
        if (e.key !== 'Tab') return;
        const focusableElems = Array.from(modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter(el => !el.disabled && el.offsetParent !== null);
        if (!focusableElems.length) return;
        const first = focusableElems[0];
        const last = focusableElems[focusableElems.length - 1];

        if (e.shiftKey && document.activeElement === first) {
            e.preventDefault();
            last.focus();
        } else if (!e.shiftKey && document.activeElement === last) {
            e.preventDefault();
            first.focus();
        }
    }

    function onKeydown(e) {
        if (e.key === 'Escape') {
            closeModal(modalId);
        }
        trapTabKey(e);
    }

    modal.__onKeydown = onKeydown;
    document.addEventListener('keydown', modal.__onKeydown);

    // Prevent clicking background from focusing away; close on background click
    modal.addEventListener('click', function bgClick(e) {
        if (e.target === modal) closeModal(modalId);
    }, { once: false });

    return true;
};

function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (!modal) return;
    // Restore focus first to avoid hiding a focused descendant (ARIA requirement)
    try {
        const prev = modal.__previouslyFocused;
        if (prev && typeof prev.focus === 'function') {
            prev.focus();
        } else if (document.activeElement && modal.contains(document.activeElement)) {
            // If no previous focus saved, blur any focused element inside modal
            try { document.activeElement.blur(); } catch (err) {}
        }
    } catch (err) {
        // ignore
    }

    // Remove keydown listener if set
    if (modal.__onKeydown) {
        document.removeEventListener('keydown', modal.__onKeydown);
        delete modal.__onKeydown;
    }

    // Hide modal and mark aria hidden
    modal.setAttribute('aria-hidden', 'true');
    modal.classList.add('hidden');
    modal.style.display = 'none';

    // Restore scrolling
    document.body.style.overflow = '';
}

// Delegated close button handler
document.addEventListener('click', function(e) {
    const closeAttr = e.target.closest('[data-close-button]');
    if (closeAttr) {
        const modalId = closeAttr.getAttribute('data-close-button');
        closeModal(modalId);
    }
});

// Delegated open handler: if a button with data-delete-modal is clicked, open modal
document.addEventListener('click', function(e) {
    const opener = e.target.closest('[data-delete-modal]');
    if (!opener) return;

    const modalId = opener.getAttribute('data-delete-modal');
    const id = opener.getAttribute('data-delete-id');
    const name = opener.getAttribute('data-delete-name');
    if (!modalId || !id) return;

    // Prevent default if it's a button inside a link or similar
    e.preventDefault();

    // Debug: log opener click
    try { console.debug('[confirm-modal] opener clicked', { modalId, id, name, opener }); } catch (err) {}

    // Call the global helper, with a small retry fallback if it's not yet defined
    if (window.openConfirmationModal) {
        // Build action URL generically: take provided data-delete-action (or current path)
        // and append the id. This works for both /admin/users and /admin/locations
        const baseAction = opener.getAttribute('data-delete-action') || window.location.pathname.replace(/\/+$, '');
        const actionUrl = baseAction.replace(/\/+$, '') + '/' + id;
        window.openConfirmationModal(modalId, actionUrl, name, { rowId: id });
    } else {
        try { console.warn('[confirm-modal] openConfirmationModal not defined yet, retrying'); } catch (err) {}
        // retry a few times
        let attempts = 0;
        const t = setInterval(() => {
            attempts++;
            if (window.openConfirmationModal) {
                const baseAction = opener.getAttribute('data-delete-action') || window.location.pathname.replace(/\/+$, '');
                const actionUrl = baseAction.replace(/\/+$, '') + '/' + id;
                window.openConfirmationModal(modalId, actionUrl, name, { rowId: id });
                clearInterval(t);
            } else if (attempts > 10) {
                try { console.error('[confirm-modal] openConfirmationModal still not defined after retries'); } catch (err) {}
                clearInterval(t);
            }
        }, 50);
    }
});

// Intercept form submissions for our modal forms
document.addEventListener('submit', function(e) {
    const form = e.target;
    if (!form || !form.id || !form.id.endsWith('_form')) return;

    // Only intercept when data-ajax isn't explicitly false
    if (form.dataset.ajax === 'false') return;

    e.preventDefault();

    const confirmBtn = document.getElementById(form.id.replace('_form', '_confirm'));
    const confirmText = confirmBtn ? confirmBtn.querySelector('.confirm-text') : null;
    const loading = confirmBtn ? confirmBtn.querySelector('.confirm-loading') : null;

    if (confirmBtn) {
        confirmBtn.disabled = true;
        if (confirmText) confirmText.textContent = 'Deleting...';
        if (loading) loading.classList.remove('hidden');
    }

    const url = form.action;
    const token = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

    fetch(url, {
        method: 'DELETE',
        headers: {
            'X-CSRF-TOKEN': token,
            'Accept': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
        },
    }).then(async res => {
        const modalId = form.id.replace('_form', '');
        const modal = document.getElementById(modalId);

        if (res.ok) {
            // Close modal
            closeModal(modalId);

            // Remove row if rowId set (support both data-location-id and data-user-id)
            const rowId = form.dataset.rowId;
            if (rowId) {
                const trLoc = document.querySelector('[data-location-id="' + rowId + '"]');
                const trUser = document.querySelector('[data-user-id="' + rowId + '"]');
                if (trLoc) trLoc.remove();
                if (trUser) trUser.remove();
            }

            // Try parse JSON message
            try {
                const data = await res.json();
                if (data && data.message) {
                    window.notify(data.message, 'success');
                } else {
                    window.notify('Deleted successfully', 'success');
                }
            } catch (err) {
                window.notify('Deleted successfully', 'success');
            }
        } else {
            // Attempt to read error
            try {
                const data = await res.json();
                window.notify(data.message || 'Delete failed', 'error');
            } catch (err) {
                window.notify('Delete failed', 'error');
            }
        }
    }).catch(err => {
        console.error('Delete error', err);
        window.notify('Network error while deleting', 'error');
    }).finally(() => {
        if (confirmBtn) {
            confirmBtn.disabled = false;
            if (confirmText) confirmText.textContent = 'Delete';
            if (loading) loading.classList.add('hidden');
        }
    });
});
</script>


<script>
window.openDeleteModal = function(id, name) {
    const action = window.location.origin + '/admin/users/' + id;
    window.openConfirmationModal('userDeleteModal', action, name, { rowId: id });
}
</script>

            </main>
        </div>
    </div>
                                                <script>
                            window.appActiveLocationId = 12;
                        </script>
                                                            
                                    <!-- Toast Notifications -->
                                    <div x-data="{ 
                                             toasts: [], 
                                             add(t) { 
                                                 const id = Date.now() + Math.random(); 
                                                 this.toasts.push({ ...t, id }); 
                                                 setTimeout(() => this.remove(id), t.ttl ?? 3500); 
                                             }, 
                                             remove(id) { 
                                                 this.toasts = this.toasts.filter(x => x.id !== id) 
                                             } 
                                         }"
                                         x-init="
                                             const api = $data; 
                                             window.notify = (msg, type='info', ttl=3500) => api.add({msg, type, ttl}); 
                                             window.addEventListener('notify', e => api.add(e.detail)); 
                                             if (window._notifyQueue && window._notifyQueue.length) { 
                                                 window._notifyQueue.splice(0).forEach(d => api.add(d)); 
                                             }
                                         "
                                         class="fixed top-6 right-6 z-50 space-y-3 max-w-sm">
                                        <template x-for="t in toasts" :key="t.id">
                                            <div x-transition:enter="transform ease-out duration-300 transition"
                                                 x-transition:enter-start="translate-y-2 opacity-0 sm:translate-y-0 sm:translate-x-2"
                                                 x-transition:enter-end="translate-y-0 opacity-100 sm:translate-x-0"
                                                 x-transition:leave="transition ease-in duration-100"
                                                 x-transition:leave-start="opacity-100"
                                                 x-transition:leave-end="opacity-0"
                                                 class="relative max-w-sm w-full rounded-xl shadow-lg overflow-hidden"
                                                 :class="{
                                                     'bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700': t.type==='info',
                                                     'bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800': t.type==='success',
                                                     'bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800': t.type==='warning',
                                                     'bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800': t.type==='error',
                                                 }">
                                                <div class="p-4">
                                                    <div class="flex items-start">
                                                        <div class="flex-shrink-0">
                                                            <!-- Info Icon -->
                                                            <svg x-show="t.type === 'info'" class="h-5 w-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                            </svg>
                                                            <!-- Success Icon -->
                                                            <svg x-show="t.type === 'success'" class="h-5 w-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                            </svg>
                                                            <!-- Warning Icon -->
                                                            <svg x-show="t.type === 'warning'" class="h-5 w-5 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                                            </svg>
                                                            <!-- Error Icon -->
                                                            <svg x-show="t.type === 'error'" class="h-5 w-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                            </svg>
                                                        </div>
                                                        <div class="ml-3 w-0 flex-1 pt-0.5">
                                                            <p class="text-sm font-medium" 
                                                               :class="{
                                                                   'text-gray-900 dark:text-gray-100': t.type==='info',
                                                                   'text-green-800 dark:text-green-200': t.type==='success',
                                                                   'text-yellow-800 dark:text-yellow-200': t.type==='warning',
                                                                   'text-red-800 dark:text-red-200': t.type==='error',
                                                               }"
                                                               x-text="t.msg"></p>
                                                        </div>
                                                        <div class="ml-4 flex-shrink-0 flex">
                                                            <button @click="$parent.remove(t.id)" 
                                                                    class="inline-flex rounded-md p-1.5 focus:outline-none focus:ring-2 focus:ring-offset-2"
                                                                    :class="{
                                                                        'text-gray-400 hover:text-gray-500 focus:ring-gray-500': t.type==='info',
                                                                        'text-green-400 hover:text-green-500 focus:ring-green-500': t.type==='success',
                                                                        'text-yellow-400 hover:text-yellow-500 focus:ring-yellow-500': t.type==='warning',
                                                                        'text-red-400 hover:text-red-500 focus:ring-red-500': t.type==='error',
                                                                    }">
                                                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                                                </svg>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
    </div>

    <!-- Floating Success Message Component -->
    <script>
        // Provide a global fallback for product form validation so modal-loaded HTML
        // (inserted via innerHTML) can call validateProductForm() even when inline
        // <script> blocks inside the loaded HTML are not executed.
        window.validateProductForm = window.validateProductForm || function() {
            try {
                const nameEl = document.getElementById('name');
                const categoryEl = document.getElementById('category_id');
                const priceEl = document.getElementById('price');

                const name = nameEl ? nameEl.value.trim() : '';
                const category = categoryEl ? categoryEl.value : '';
                const price = priceEl ? parseFloat(priceEl.value) : NaN;

                if (!name) {
                    alert('Product name is required');
                    return false;
                }

                if (!category) {
                    alert('Category is required');
                    return false;
                }

                if (isNaN(price) || price < 0) {
                    alert('Valid price is required');
                    return false;
                }

                return true;
            } catch (err) {
                // If anything unexpected happens, allow the form to submit so server-side
                // validation can handle it. Log to console for debugging.
                console.error('validateProductForm error:', err);
                return true;
            }
        };
    </script>

    <div x-data="floatingSuccessComponent()" 
x-show="show"
x-transition:enter="transform ease-out duration-800"
x-transition:enter-start="-translate-y-full opacity-50"
x-transition:enter-end="translate-y-0 opacity-50"
x-transition:leave="transform ease-in duration-800 delay-500"
x-transition:leave-start="translate-y-0 opacity-50"
x-transition:leave-end="-translate-y-full opacity-50"
class="fixed top-8 left-1/2 transform -translate-x-1/2 z-50"
x-cloak
id="floating-success">
    <!-- Success Message Card -->
    <div class="bg-green-600 dark:bg-green-700 text-white px-2 py-1 rounded-xl border border-green-500 dark:border-green-600 max-w-md">
        
        <div class="flex items-center">
            <!-- Success Icon -->
            <div class="flex-shrink-0">
                <svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            
            <!-- Message Text -->
            <div class="ml-3 flex-1">
                <p class="text-sm font-normal" x-text="message">
                    
                </p>
            </div>
                        
        </div>
    </div>
</div>

<script>
// Alpine.js component function
function floatingSuccessComponent() {
    return {
        show: false,
        message: '',
        timer: null,
        
        init() {
            console.log('Floating success component initialized');
            
            // Check for session message
                        
            // Register global functions
            window.showFloatingSuccess = (msg) => this.showMessage(msg);
            window.hideFloatingSuccess = () => this.hideMessage();
        },
        
        showMessage(text) {
            console.log('showMessage called with:', text);
            this.message = text;
            this.show = true;
            this.startAutoHide();
        },
        
        hideMessage() {
            this.show = false;
            if (this.timer) {
                clearTimeout(this.timer);
                this.timer = null;
            }
        },
        
        startAutoHide() {
            if (this.timer) {
                clearTimeout(this.timer);
            }
            this.timer = setTimeout(() => {
                this.hideMessage();
            }, 3000);
        }
    }
}

// Backup global function (in case Alpine isn't ready)
window.showFloatingSuccess = window.showFloatingSuccess || function(message) {
    console.log('Backup showFloatingSuccess called:', message);
    
    // Try to find Alpine component
    const component = document.getElementById('floating-success');
    if (component && component._x_dataStack && component._x_dataStack[0]) {
        component._x_dataStack[0].showMessage(message);
        return;
    }
    
    // Fallback: create a simple notification
    const notification = document.createElement('div');
    notification.className = 'fixed top-8 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-6 py-4 rounded-xl shadow-2xl z-50 max-w-md';
    notification.innerHTML = `
        <div class="flex items-center">
            <svg class="h-6 w-6 text-white mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span class="text-sm font-medium">${message}</span>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 3000);
};
</script>
</body>
</html>

